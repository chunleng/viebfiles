" Custom
set search=https://www.google.com/search?q=%s
set followchars="custom:duhetonas"
set splitbelow
set splitright
set followelement="url,onclick,inputs-insert,inputs-click"
set followelementpointer="media,image,other"
set guifontsize=12
set noshowcmd
set suspendtimeout=3600000
    " 1 hour
set redirects="https?://(www\.)?google\.com(\.\w+)?/amp/s/amp\.(.*)~https://$3"
set redirects+=",https://(localhost|127.0.0.1)(.*)~http://$1$2"
set userstyle=true
set nativetheme=dark
set reloadtaboncrash=true

" Mappings
nnoremap <space>bh <:lclose>
nnoremap <space>bl <:rclose>
nnoremap <tab> <:b #>
nnoremap <c-,> <moveTabBackward>
nnoremap <c-.> <moveTabForward>
noremap <c-m-,> <moveTabBackward>
noremap <c-m-.> <moveTabForward>
nnoremap <c-h> <toLeftSplitWindow>
noremap <c-m-h> <toLeftSplitWindow>
nnoremap <c-l> <toRightSplitWindow>
noremap <c-m-l> <toRightSplitWindow>
nnoremap <c-j> <toBottomSplitWindow>
noremap <c-m-j> <toBottomSplitWindow>
nnoremap <c-k> <toTopSplitWindow>
noremap <c-m-k> <toTopSplitWindow>
nnoremap <s-left> <:vsplit #><exchangeSplitWindow><toLeftSplitWindow>
nnoremap <s-right> <:vsplit #>
nnoremap <s-down> <:split #><exchangeSplitWindow><toTopSplitWindow>
nnoremap <s-up> <:split #>

" Make scrollable even in insert mode
inoremap <c-d> <scrollPageDownHalf>
inoremap <c-u> <scrollPageUpHalf>

nnoremap gp <:pin>
nnoremap gt <toCommandMode>b<space>

noremap <m-q> <:quitall>
nnoremap <space>x <:hide>
nnoremap <c-x> <:close>
noremap <m-w> <:close>

noremap <m-c-p> <previousTab>
noremap <m-c-n> <nextTab>

noremap <m-l> <toExploreMode>
nnoremap o <toExploreMode>
noremap <m-t> <:tabnew><toExploreMode>
noremap <m-r> <refreshTab>
nnoremap t <:tabnew><toExploreMode>

nnoremap <m-left> <backInHistory>
pnoremap <m-left> <backInHistory>
vnoremap <m-left> <backInHistory>
cnoremap <m-left> <backInHistory>
enoremap <m-left> <backInHistory>
nnoremap <c-i> <forwardInHistory>
nnoremap <m-right> <forwardInHistory>
pnoremap <m-right> <forwardInHistory>
vnoremap <m-right> <forwardInHistory>
cnoremap <m-right> <forwardInHistory>
enoremap <m-right> <forwardInHistory>

nnoremap <m-c> <p.copyText>
vnoremap <m-c> <p.copyText>

nnoremap + <zoomIn>
nnoremap - <zoomOut>
nnoremap = <zoomReset>

pnoremap <up> <p.scrollUp>
pnoremap <down> <p.scrollDown>
pnoremap <right> <p.scrollRight>
pnoremap <left> <p.scrollLeft>
pnoremap <c-u> 3<p.scrollUp>
pnoremap <c-d> 3<p.scrollDown>
vnoremap <c-u> 3<p.scrollUp>
vnoremap <c-d> 3<p.scrollDown>
pnoremap ? <p.inspectElement>
pnoremap : <toCommandMode>

fnoremap <c-d> <scrollPageDownHalf>
fnoremap <c-u> <scrollPageDownHalf>

set permissioncamera=ask
set permissionmicrophone=ask
set permissionmediadevices=allow
set permissioncertificateerror=ask
set permissionclipboardread=ask
set permissiondisplaycapture=ask
" set permissiongeolocation=ask
set permissionhid=allow
set permissionnotifications=ask

set dialogalert=show
set dialogprompt=show
set dialogconfirm=show

set devtoolsposition=vsplit
nnoremap <space>d <:devtools>
nnoremap <c-space> <toCommandMode>b<space>

nnoremap <c-z> <:%suspend>
nnoremap 0 <:b 0>
nnoremap $ <:b -1>


" Commands
colorscheme custom

set vimcommand="$([[ -f "/opt/homebrew/bin/kitty" ]] && echo "/opt/homebrew" || echo "/usr/local")/bin/kitty -1 ~/.asdf/shims/nvim +'setf browser'"

nunmap d

inoremap <c-k> <s-end><bs>
inoremap <c-u> <s-home><bs>
" inoremap <c-w> <s-left><a-s-left><bs>
inoremap <c-w> <:runjsinpage ~/.vieb/scripts/delete_word.js>
cnoremap <c-k> <s-end><bs>
cnoremap <c-u> <s-home><bs>
cnoremap <c-w> <s-left><a-s-left><bs>
cnoremap <c-a> <home>
cnoremap <c-e> <end>
enoremap <c-k> <s-end><bs>
enoremap <c-u> <s-home><bs>
enoremap <c-w> <s-left><a-s-left><bs>
enoremap <c-a> <home>
enoremap <c-e> <end>
enoremap <c-b> <left>
enoremap <c-f> <right>
snoremap <c-k> <s-end><bs>
snoremap <c-u> <s-home><bs>
snoremap <c-w> <s-left><a-s-left><bs>
snoremap <c-a> <home>
snoremap <c-e> <end>
snoremap <c-b> <left>
snoremap <c-f> <right>

" Enable to <esc> to work
nnoremap <esc> <toInsertMode><esc><toSearchMode><bs><toNormalMode>

" Password AutoComplete
" Timeout is set because runjsinpage executes before openLinkExternal
inoremap <c-space>u <:set externalcommand="~/.vieb/scripts/get_page_username.sh"><action.openLinkExternal><:runjsinpage setTimeout(function(){document.execCommand('paste')}, 500)>
inoremap <c-space>p <:set externalcommand="~/.vieb/scripts/get_page_password.sh"><action.openLinkExternal><:runjsinpage setTimeout(function(){document.execCommand('paste')}, 500)>
inoremap <c-space>g <:set externalcommand="$([[ -f "/opt/homebrew/bin/kitty" ]] && echo "/opt/homebrew" || echo "/usr/local")/bin/kitty -1 ~/.vieb/scripts/generate_page_password.sh"><action.openLinkExternal>
" unset openLinkExternal
nunmap x


" Permission Management
set permissionsallowed=
set permissionsallowed+=todoist.com~notifications
set permissionsallowed+=whatsapp.com~notifications

" Viebrc generated by Vieb
" vim: ft=vim
